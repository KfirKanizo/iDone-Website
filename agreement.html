<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
  <title>הסכם שירות – iDone</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    .agreement-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 10px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .agreement-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #8e52db;
    }

    .agreement-title {
      font-size: 2em;
      font-weight: 700;
      color: #333;
      margin-bottom: 10px;
    }

    .agreement-date {
      font-size: 1.1em;
      color: #666;
    }

    .agreement-content {
      line-height: 1.8;
      font-size: 1.1em;
      text-align: justify;
    }

    .agreement-content h3 {
      color: #8e52db;
      margin-top: 25px;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .agreement-content p {
      margin-bottom: 15px;
    }

    .agreement-content ul {
      margin-bottom: 15px;
      padding-right: 20px;
    }

    .agreement-content li {
      margin-bottom: 8px;
    }

    .signature-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid #8e52db;
    }

    .signature-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 30px;
    }

    .signature-box {
      flex: 1;
      text-align: center;
      max-width: 400px;
    }

    .signature-box h4 {
      margin-bottom: 15px;
      color: #333;
      font-size: 1.2em;
    }

    .signature-canvas {
      border: 2px solid #ddd;
      border-radius: 8px;
      background: white;
      cursor: crosshair;
      margin: 0 auto 10px auto;
      display: block;
      touch-action: none;
    }

    .signature-controls {
      margin-top: 10px;
    }

    .signature-controls button {
      background: #8e52db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 5px;
      font-size: 0.9em;
    }

    .signature-controls button:hover {
      background: #0056b3;
    }

    .signature-controls button.clear {
      background: #5a2d8a;
    }

    .signature-controls button.clear:hover {
      background: #4a2573;
    }

    .form-section {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 700;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1em;
      font-family: 'Heebo', sans-serif;
    }

    .form-group input:focus {
      outline: none;
      border-color: #8e52db;
    }

    .submit-section {
      text-align: center;
      margin-top: 30px;
    }

    .submit-btn {
      background: #8e52db;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }

    .submit-btn:hover {
      background: #7a47c7;
    }

    .submit-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .loading {
      display: none;
      text-align: center;
      margin-top: 20px;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #8e52db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      text-align: center;
    }

    .error-message {
      display: none;
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      text-align: center;
    }

    .dynamic-field {
      background: rgba(142, 82, 219, 0.2);
      padding: 5px 10px;
      border-radius: 3px;
      font-weight: 700;
      color: #8e52db;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .dynamic-field:hover {
      background: rgba(142, 82, 219, 0.3);
    }

    .popup-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .popup-content {
      background-color: white;
      margin: 15% auto;
      padding: 30px;
      border-radius: 10px;
      width: 80%;
      max-width: 400px;
      position: relative;
      text-align: center;
    }

    .close-popup {
      color: #aaa;
      float: left;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 15px;
    }

    .close-popup:hover {
      color: #000;
    }

    .popup-content h3 {
      margin-bottom: 20px;
      color: #333;
    }

    .popup-content .form-group {
      margin-bottom: 20px;
    }

    .popup-content input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1em;
      font-family: 'Heebo', sans-serif;
    }

    .popup-content input:focus {
      outline: none;
      border-color: #8e52db;
    }

    @media (max-width: 768px) {
      .agreement-container {
        margin: 10px;
        padding: 15px;
      }
      
      .signature-container {
        flex-direction: column;
        gap: 20px;
      }
      
      .agreement-title {
        font-size: 1.5em;
      }
    }
  </style>
</head>

<body>

  <!-- Include components -->
  <div id="header"></div>

  <div class="agreement-container">
    <div class="agreement-header">
      <h1 class="agreement-title">טיוטת הסכם שירות – iDone</h1>
      <p class="agreement-date">תאריך: <span id="current-date"></span></p>
    </div>

    <div class="agreement-content" id="agreement-content">
      <p>
        הסכם זה נערך ונחתם בתאריך <span id="agreement-date"></span> (להלן: "מועד החתימה"), בין חברת iDone (להלן: "הספק") מצד אחד, לבין <span class="dynamic-field" id="client-name">______________</span> ת.ז. <span class="dynamic-field" id="client-id">________</span> (להלן: "הלקוח") מן הצד השני.
      </p>

      <p>
        הואיל והספק הינו בעל מומחיות במתן שירותי אוטומציה, ייעול תהליכים, אינטגרציות טכנולוגיות ושירותים נלווים, כמפורט להלן;
      </p>

      <p>
        והואיל והלקוח מעוניין לקבל מהספק את השירותים המקצועיים המוצעים על ידו;
      </p>

      <p>
        לפיכך הותנה והוסכם בין הצדדים כדלקמן:
      </p>

      <h3>1. תיאור השירותים</h3>
      <p>
        הספק יעניק ללקוח שירותים מקצועיים בהתאם לצרכי הלקוח, הכוללים בין היתר:
      </p>
      <ul>
        <li><strong>אוטומציית תהליכים</strong> – ניהול אוטומטי למשימות חוזרות, תזכורות, לידים ומעקב לקוחות, לשם חיסכון בזמן ושיפור הביצועים.</li>
        <li><strong>מערכות CRM וצ'אטבוטים</strong> – הקמה וחיבור של מערכות CRM משולבות בצ'אטבוטים מתקדמים (למשל לוואטסאפ, פייסבוק ודפי נחיתה) לצורך מענה מהיר ואוטומטי וסגירת מעגל טיפול בפניות.</li>
        <li><strong>ייעוץ לשיפור ביצועים</strong> – ניתוח תהליכים קיימים בארגון והמלצה על אוטומציות ופתרונות טכנולוגיים חכמים התורמים ליעילות, לצמיחה עסקית ולשיפור חוויית הלקוח.</li>
        <li><strong>טפסים חכמים ודפי נחיתה</strong> – תכנון ובנייה של טפסים אינטראקטיביים ודפי נחיתה מחוברים למערכת ה-CRM, המאפשרים איסוף מידע אוטומטי בלחיצת כפתור.</li>
        <li><strong>אינטגרציות מותאמות אישית</strong> – פיתוח חיבורים חכמים בין מערכות וכלים שונים (כגון Google Workspace, Make, Airtable, Fireberry, GreenAPI וכדומה) לצורך יצירת זרימה אוטומטית של מידע בין הפלטפורמות ללא צורך בכתיבת קוד.</li>
      </ul>

      <p>
        הרשימה לעיל מהווה תיאור כללי של תחומי השירות העיקריים. פירוט מדויק של השירותים שיוענקו, היקפם והמפרט הטכני שלהם יופיע בהצעת הפתרון האישית שתיערך עבור הלקוח ותאושר על ידו בכתב (להלן: "הצעת הפתרון"). הצעת הפתרון המוסכמת תהווה חלק בלתי נפרד מהסכם זה.
      </p>

      <h3>2. תמחור על בסיס שעות עבודה</h3>
      <p>
        התמורה עבור השירותים תבוצע על בסיס שעות עבודה בפועל ולא על בסיס תעריף קבוע או סכום גלובלי. התעריף השעתי ייקבע ויצוין בהצעת הפתרון וההצעה תכלול אומדן עלות משוער בהתאם להיקף העבודה הצפוי. מובהר כי אומדן זה הוא לצרכי תכנון בלבד ואינו מחייב כתעריף סופי – החיוב הסופי יתבצע בהתאם למספר שעות העבודה שהושקעו בפועל על ידי הספק בביצוע השירותים. כל שינוי מהותי בהיקף העבודה או בחריגה מהאומדן יהיה טעון הסכמה מראש של הלקוח. לא ייגבו תשלומים עבור עבודה נוספת מבלי לקבל את אישור הלקוח לביצועה.
      </p>

      <h3>3. שימוש בפלטפורמות וכלים חיצוניים</h3>
      <p>
        הלקוח מודע לכך שבמסגרת מתן השירותים ייתכן ויעשה שימוש בכלי תוכנה או פלטפורמות צד-שלישי (לרבות פלטפורמות מקוונות) שחלקם עשויים להיות בתשלום חיצוני – כגון Google Workspace, WordPress Premium, Make, Airtable, Fireberry, GreenAPI וכיו"ב. במקרה בו נדרש שימוש בפלטפורמה או שירות חיצוני בעלות נפרדת, הלקוח יישא באחריות המלאה לרכישה, למימון ולניהול החשבון באותה פלטפורמה. פירוש הדבר הוא שהלקוח יפתח על שמו ובמימונו חשבונות משתמש נדרשים, ישלם ישירות לספקי הפלטפורמות החיצוניות עבור רישיונות או מנויים ככל שיידרש, ויפעל בהתאם לתנאי השימוש של אותן פלטפורמות. למען הסר ספק, עלויות פלטפורמות צד שלישי אינן כלולות בתמורה המשולמת לספק במסגרת הסכם זה, והספק לא יישא בכל תשלום לצדדים שלישיים אלה.
      </p>

      <h3>4. מדיניות ביטול</h3>
      <h4>4.1 ביטול על ידי הלקוח:</h4>
      <p>
        הלקוח רשאי לבטל את ההתקשרות שבהסכם בכל עת לפני השלמת מלוא השירותים, בהודעה מוקדמת בכתב של 14 יום שתימסר לספק. במקרה של ביטול ביוזמת הלקוח, הלקוח ישלם לספק תשלום עבור כל השירותים והעבודה שבוצעו על ידי הספק עד למועד הביטול בפועל. תשלומים שכבר שולמו לספק לא יוחזרו בגין שירותים שכבר סופקו או שעות עבודה שהושקעו עד אותה נקודה. אם הלקוח שילם מראש עבור חלק מהשירותים שטרם סופקו, הספק יחזיר ללקוח את החלק היחסי עבור השירותים שלא בוצעו, בניכוי הוצאות שהוציא הספק בהתבסס על התחייבות זו (אם הוציא).
      </p>

      <h4>4.2 ביטול על ידי הספק:</h4>
      <p>
        הספק רשאי לבטל את ההסכם או להפסיק את מתן השירותים בהודעה מוקדמת בכתב של 14 יום ללקוח, במקרה שהלקוח מפר הפרה מהותית את התחייבויותיו לפי הסכם זה (כגון אי-תשלום במועד, חוסר שיתוף פעולה מתמשך, וכו'), או בכל מקרה בו מתעורר אצל הספק טעם מקצועי סביר להפסקת ההתקשרות. במקרה של ביטול ההסכם על ידי הספק, לא יידרש מהלקוח תשלום נוסף מעבר לתשלום עבור העבודה שבוצעה בפועל עד מועד הביטול, והספק ישיב ללקוח כל סכום ששולם מראש עבור שירותים שלא סופקו.
      </p>

      <h4>4.3 השלכות הביטול:</h4>
      <p>
        עם ביטול ההסכם, מכל סיבה שהיא, יחדל הספק מלספק את השירותים, והלקוח מתחייב לשלם לאלתר את כל התשלומים המגיעים לספק עבור שירותים שבוצעו עד למועד הביטול. סעיפים בהסכם זה אשר מטבעם מיועדים להמשיך ולחול גם לאחר סיומו (כגון חובת סודיות, תשלום חובה שהצטבר, וכיוצ"ב) ימשיכו לעמוד בתוקפם גם לאחר ביטול ההסכם.
      </p>

      <h3>5. תנאי תשלום</h3>
      <p>
        התשלום עבור השירותים ייעשה כנגד חשבוניות מס/קבלה שיוציא הספק ללקוח. אלא אם הוסכם אחרת בהצעת הפתרון, הספק יגיש ללקוח חשבונית אחת לחודש בגין שעות העבודה שסופקו בחודש שקדם למועד החשבונית, או עם סיום אבני דרך משמעותיות כפי שיפורטו בהצעת הפתרון. הלקוח מתחייב לשלם לספק את סכומי החשבונית תוך 14 ימים ממועד קבלתה. כל הסכומים בהסכם זה נקובים ב___ (ש"ח/דולר/מטבע אחר בהתאם להצעת הפתרון) ואינם כוללים מע"מ, אשר יתווסף לכל סכום לתשלום בהתאם לשיעור המע"מ החוקי במועד החיוב. התשלום יבוצע באמצעי התשלום שיוסכם בין הצדדים (כגון העברה בנקאית לחשבון הספק או תשלום בכרטיס אשראי), כפי שיפורט בהצעת הפתרון או בפרטי החשבונית. אי תשלום במועדו יהווה הפרה יסודית של ההסכם. במקרה של פיגור בתשלום, יהיה הספק רשאי, לאחר מתן התראה בכתב ללקוח, להשהות את מתן השירותים עד להסדרת התשלום, וזאת מבלי לגרוע מזכותו של הספק לכל סעד אחר הקיים לו על פי דין או הסכם (כולל הזכות לפיצויי פיגורים בהתאם לדין).
      </p>

      <h3>6. לוחות זמנים לביצוע השירותים</h3>
      <p>
        לוחות הזמנים לביצוע השירותים ייקבעו בהצעת הפתרון שתוגש ללקוח ותאושר על ידו. הספק מתחייב לבצע את השירותים בהתאם ללוחות הזמנים המוסכמים, ולהשקיע מאמצים סבירים לעמידה במועדים שנקבעו. הלקוח מצדו מתחייב לספק לספק את כל המידע, החומרים, הגישה למערכות ואישורי הביניים הנדרשים ממנו במועד, על מנת לאפשר לספק לעמוד בלוחות הזמנים שנקבעו. הצדדים מסכימים כי במקרה של עיכובים שאינם בשליטת הספק – לרבות עיכובים הנובעים מאיחור במסירת מידע או אישורים על ידי הלקוח, שינויים בדרישות על ידי הלקוח, או עיכובים הנובעים מצדדים שלישיים (לדוגמה, עיכובים טכניים של ספקי תוכנה חיצוניים) – יהיה הספק זכאי להארכה סבירה של לוחות הזמנים, בתיאום עם הלקוח. כל שינוי מהותי בלוחות הזמנים יתועד ויאושר בין הצדדים בכתב.
      </p>

      <h3>7. סודיות וקניין רוחני</h3>
      <p>
        הספק מתחייב לשמור בסודיות כל מידע עסקי או טכני של הלקוח שיגיע לידיו במסגרת ביצוע השירותים, ולא לגלותו לכל צד שלישי ללא הסכמת הלקוח, למעט אם המידע נהפך לנחלת הכלל שלא בשל מעשה או מחדל של הספק, או אם קיימת חובה חוקית לגלותו. התחייבות הסודיות תחול במשך תקופת ההסכם וגם לאחר סיומו. כל חומר, מסמך או מידע שיועבר על ידי הלקוח לספק לצורך ביצוע ההסכם יישאר בבעלות הלקוח, והספק לא יעשה בו שימוש מלבד לצורך מתן השירותים ללקוח. לעומת זאת, התוצרים והפתרונות שיפותחו על ידי הספק במסגרת ביצוע השירותים עבור הלקוח יהיו שייכים ללקוח עם תשלום מלוא התמורה המוסכמת עבורם, וזכויות הקניין הרוחני בהם יעברו ללקוח עם התשלום כאמור, למעט אם הוסכם אחרת בהצעת הפתרון (לדוגמה, במקרה של רישיון שימוש בכלי תוכנה שפותח על ידי הספק). הספק שומר לעצמו זכות שימוש בידע הכללי, בניסיון ובמיומנויות שפיתח במהלך העבודה, לצרכיו העסקיים, ובלבד שאין בשימוש כזה כדי לחשוף מידע סודי של הלקוח.
      </p>

      <h3>8. שונות</h3>
      <h4>8.1 הסכם שלם:</h4>
      <p>
        מסמך זה, לרבות נספחיו והצעת הפתרון המצורפת אליו, מהווה את ההסכם השלם והממצה בין הצדדים בכל הנוגע לנושאו, והוא גובר על כל מצג, הסכמה, מו"מ או התחייבות קודמים בנושא. שום שינוי, תיקון או ויתור על תנאי מתנאי הסכם זה לא יהיה בר תוקף אלא אם נעשה בכתב ונחתם על ידי שני הצדדים.
      </p>

      <h4>8.2 הדין וסמכות שיפוט:</h4>
      <p>
        על הסכם זה יחולו דיני מדינת ישראל. סמכות השיפוט הבלעדית בכל עניין ומחלוקת הנובעים מההסכם תהיה נתונה לבתי המשפט המוסמכים באזור מחוז תל-אביב, בכפוף לזכותו של הספק לפנות לערכאה אחרת המוסמכת לדון בענין על פי דין לצורך קבלת סעדים דחופים (כגון צווי מניעה).
      </p>

      <h4>8.3 שמירת תוקף:</h4>
      <p>
        אם ייקבע על ידי ערכאה מוסמכת כי הוראה כלשהי מהוראות הסכם זה הינה בלתי חוקית, בטלה או בלתי אכיפה, ההוראה האמורה תפורש או תצומצם במידה המינימלית הנדרשת כדי לייתרה או להתאימה לדין, וזאת מבלי לגרוע מתוקפם של שאר תנאי ההסכם. יתר הוראות ההסכם יוסיפו לחול ולשמור על מלוא תוקפן וכוחן.
      </p>

      <h4>8.4 ויתור ועצמאות סעיפים:</h4>
      <p>
        אי מימוש או עיכוב במימוש של זכות כלשהי ע"י אחד הצדדים לא ייחשב כוויתור על זכות זו. כל זכות או סעד יהיו מצטברים ולא ניתנים לגריעה. כותרות הסעיפים בהסכם זה נועדו לנוחות בלבד, ולא תשמשנה לפרשנות ההוראות. הצדדים הינם קבלנים עצמאיים, ושום דבר בהסכם זה לא יפורש כיוצר יחסי שותפות, סוכנות, העסקה או יחסי נאמנות בין הצדדים.
      </p>

      <p style="margin-top: 30px; font-weight: 700;">
        ולראיה באו הצדדים על החתום:
      </p>
    </div>

    <div class="signature-section">
      <div class="signature-container">
        <div class="signature-box">
          <h4>חתימת הלקוח</h4>
          <canvas id="client-signature" class="signature-canvas" width="300" height="150"></canvas>
          <div class="signature-controls">
            <button type="button" onclick="clearSignature('client-signature')" class="clear">נקה חתימה</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Popup Modal -->
    <div id="popup-modal" class="popup-modal">
      <div class="popup-content">
        <span class="close-popup">&times;</span>
        <h3 id="popup-title">הכנס פרטים</h3>
        <div class="form-group">
          <label id="popup-label" for="popup-input">שדה:</label>
          <input type="text" id="popup-input" placeholder="הכנס ערך">
        </div>
        <button type="button" class="submit-btn" onclick="savePopupValue()">שמור</button>
      </div>
    </div>

    <div class="submit-section">
      <button type="button" id="submit-btn" class="submit-btn" onclick="submitAgreement()">
        שלח הסכם חתום
      </button>
      <div class="loading" id="loading"></div>
      <div class="success-message" id="success-message">
        ההסכם נשלח בהצלחה! תקבל עותק באימייל.
      </div>
      <div class="error-message" id="error-message">
        אירעה שגיאה בשליחת ההסכם. אנא נסה שוב.
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer"></div>

  <script src="js/main.js"></script>
  <script>
    // Load components
    async function loadComponents() {
      try {
        const headerResponse = await fetch('components/header.html');
        const headerData = await headerResponse.text();
        document.getElementById('header').innerHTML = headerData;

        const footerResponse = await fetch('components/footer.html');
        const footerData = await footerResponse.text();
        document.getElementById('footer').innerHTML = footerData;
      } catch (error) {
        console.error('Error loading components:', error);
      }
    }

    loadComponents();

    // Popup functionality
    let currentEditingField = null;

    function openPopup(fieldType, currentValue) {
      const modal = document.getElementById('popup-modal');
      const title = document.getElementById('popup-title');
      const label = document.getElementById('popup-label');
      const input = document.getElementById('popup-input');
      
      currentEditingField = fieldType;
      
      if (fieldType === 'name') {
        title.textContent = 'הכנס שם לקוח';
        label.textContent = 'שם מלא:';
        input.placeholder = 'הכנס את שמך המלא';
      } else if (fieldType === 'id') {
        title.textContent = 'הכנס תעודת זהות';
        label.textContent = 'תעודת זהות:';
        input.placeholder = 'הכנס מספר תעודת זהות';
      }
      
      input.value = currentValue || '';
      modal.style.display = 'block';
      input.focus();
    }

    function closePopup() {
      const modal = document.getElementById('popup-modal');
      modal.style.display = 'none';
      currentEditingField = null;
    }

    function savePopupValue() {
      const input = document.getElementById('popup-input');
      const value = input.value.trim();
      
      if (!value) {
        alert('אנא הכנס ערך');
        return;
      }
      
      if (currentEditingField === 'name') {
        document.getElementById('client-name').textContent = value;
      } else if (currentEditingField === 'id') {
        document.getElementById('client-id').textContent = value;
      }
      
      closePopup();
    }

    // Close popup when clicking outside or on X
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('popup-modal');
      if (event.target === modal) {
        closePopup();
      }
    });

    document.querySelector('.close-popup').addEventListener('click', closePopup);

    // Add click handlers to dynamic fields
    function addClickHandlers() {
      document.getElementById('client-name').addEventListener('click', function() {
        openPopup('name', this.textContent);
      });
      
      document.getElementById('client-id').addEventListener('click', function() {
        openPopup('id', this.textContent);
      });
    }

    // Initialize signature canvases
    let isDrawing = false;
    let currentCanvas = null;
    let currentContext = null;

    function initSignatureCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
      
      // Touch events for mobile
      canvas.addEventListener('touchstart', handleTouch);
      canvas.addEventListener('touchmove', handleTouch);
      canvas.addEventListener('touchend', stopDrawing);
    }

    function handleTouch(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = e.target.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      
      if (e.type === 'touchstart') {
        isDrawing = true;
        currentCanvas = e.target;
        currentContext = currentCanvas.getContext('2d');
        currentContext.beginPath();
        currentContext.moveTo(x, y);
      } else if (e.type === 'touchmove') {
        if (!isDrawing) return;
        currentContext.lineTo(x, y);
        currentContext.stroke();
      }
    }

    function startDrawing(e) {
      isDrawing = true;
      currentCanvas = e.target;
      currentContext = currentCanvas.getContext('2d');
      
      const rect = currentCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      currentContext.beginPath();
      currentContext.moveTo(x, y);
    }

    function draw(e) {
      if (!isDrawing) return;
      
      const rect = currentCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      currentContext.lineTo(x, y);
      currentContext.stroke();
    }

    function stopDrawing() {
      isDrawing = false;
    }

    function clearSignature(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Initialize signature canvas
    initSignatureCanvas('client-signature');

    // URL Parameters handling
    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function populateDynamicFields() {
      const clientName = getUrlParameter('name') || '';
      const clientId = getUrlParameter('id') || '';

      // Update agreement content
      if (clientName) {
        document.getElementById('client-name').textContent = clientName;
      }
      if (clientId) {
        document.getElementById('client-id').textContent = clientId;
      }

      // Set current date
      const today = new Date();
      const dateString = today.toLocaleDateString('he-IL');
      document.getElementById('current-date').textContent = dateString;
      document.getElementById('agreement-date').textContent = dateString;
    }

    // Submit agreement function
    async function submitAgreement() {
      const submitBtn = document.getElementById('submit-btn');
      const loading = document.getElementById('loading');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');

      // Validate required fields
      const clientName = document.getElementById('client-name').textContent;
      const clientId = document.getElementById('client-id').textContent;

      if (!clientName || clientName === '______________' || !clientId || clientId === '________') {
        alert('אנא מלא את פרטי הלקוח (שם ותעודת זהות)');
        return;
      }

      // Check if signature is provided
      const clientCanvas = document.getElementById('client-signature');
      const ctx = clientCanvas.getContext('2d');
      const imageData = ctx.getImageData(0, 0, clientCanvas.width, clientCanvas.height);
      const data = imageData.data;
      
      // Check if canvas has any non-white pixels (signature)
      let hasSignature = false;
      for (let i = 0; i < data.length; i += 4) {
        // Check if pixel is not white (not 255,255,255)
        if (data[i] !== 255 || data[i + 1] !== 255 || data[i + 2] !== 255) {
          hasSignature = true;
          break;
        }
      }
      
      if (!hasSignature) {
        alert('אנא חתום על החתימה');
        return;
      }

      // Show loading
      submitBtn.disabled = true;
      loading.style.display = 'block';
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';

      try {
        // Send to webhook
        await sendToWebhook();

        // Show success message
        successMessage.style.display = 'block';
        submitBtn.disabled = false;
        loading.style.display = 'none';

      } catch (error) {
        console.error('Error submitting agreement:', error);
        errorMessage.style.display = 'block';
        submitBtn.disabled = false;
        loading.style.display = 'none';
      }
    }



    async function sendToWebhook() {
      const formData = new FormData();
      
      // Add data as JSON string
      const clientData = {
        name: document.getElementById('client-name').textContent,
        date: new Date().toISOString(),
        id: document.getElementById('client-id').textContent
      };
      formData.append('data', JSON.stringify(clientData));
      
      // Get signature as blob
      const clientCanvas = document.getElementById('client-signature');
      const signatureBlob = await new Promise((resolve) => {
        clientCanvas.toBlob(blob => {
          if (blob) {
            formData.append('signature.png', blob, 'signature.png');
          }
          resolve();
        }, 'image/png');
      });

      const response = await fetch('https://hook.eu2.make.com/t4xess2o4r1tmasaqydj24i19uz533jx', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        throw new Error(`Webhook failed: ${response.status}`);
      }

      return response;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      populateDynamicFields();
      addClickHandlers();
    });
  </script>
</body>

</html> 